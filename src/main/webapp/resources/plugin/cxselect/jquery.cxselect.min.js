/*!
 * jQuery cxSelect
 * @name jquery.cxselect.js
 * @version 1.3.9
 * @date 2016-01-06
 * @author ciaoca
 * @email ciaoca@gmail.com
 * @site https://github.com/ciaoca/cxSelect
 * @license Released under the MIT license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(window.jQuery||window.Zepto||window.$)}}(function(a){a.cxSelect=function(){var b={dom:{},api:{}};b.init=function(){var e=this;var g;var j=function(i){if(i&&(typeof HTMLElement==="function"||typeof HTMLElement==="object")&&i instanceof HTMLElement){return true}else{return(i&&i.nodeType&&i.nodeType===1)?true:false}};var c=function(i){return(i&&i.length&&(typeof jQuery==="function"||typeof jQuery==="object")&&i instanceof jQuery)?true:false};for(var f=0,d=arguments.length;f<d;f++){if(c(arguments[f])){e.dom.box=arguments[f]}else{if(j(arguments[f])){e.dom.box=a(arguments[f])}else{if(typeof arguments[f]==="object"){g=arguments[f]}}}}if(!e.dom.box.length){return}e.settings=a.extend({},a.cxSelect.defaults,g,{url:e.dom.box.data("url"),nodata:e.dom.box.data("nodata"),required:e.dom.box.data("required"),firstTitle:e.dom.box.data("firstTitle"),firstValue:e.dom.box.data("firstValue"),jsonSpace:e.dom.box.data("jsonSpace"),jsonName:e.dom.box.data("jsonName"),jsonValue:e.dom.box.data("jsonValue"),jsonSub:e.dom.box.data("jsonSub")});var h=e.dom.box.data("selects");if(typeof h==="string"&&h.length){e.settings.selects=h.split(",")}if(!a.isArray(e.settings.selects)||!e.settings.selects.length){return}e.selectArray=[];var k;for(var f=0,d=e.settings.selects.length;f<d;f++){k=e.dom.box.find("select."+e.settings.selects[f]);if(!k){break}if(typeof k.val()==="string"&&k.val().length){k.attr("data-value",k.val())}e.selectArray.push(k)}if(!e.selectArray.length){return}e.dom.box.on("change","select",function(){e.selectChange(this.className)});if(!e.settings.url){e.start()}else{if(typeof e.settings.url==="string"&&e.settings.url.length){a.getJSON(e.settings.url,function(i){e.start(i)})}else{if(typeof e.settings.url==="object"){e.start(e.settings.url)}}}};b.getIndex=function(c){return(this.settings.required)?c:c-1};b.start=function(h){var e=this;var g=e.settings.jsonSpace;e.dataJson=undefined;if(h&&typeof h==="object"){e.dataJson=h;if(typeof g==="string"&&g.length){var d=g.split(".");for(var f=0,c=d.length;f<c;f++){e.dataJson=e.dataJson[d[f]]}}}if(e.dataJson||(typeof e.selectArray[0].data("url")==="string"&&e.selectArray[0].data("url").length)){e.getOptionData(0)}else{e.selectArray[0].prop("disabled",false).css({"display":"","visibility":""})}};b.selectChange=function(d){if(typeof d!=="string"||!d.length){return}d=d.replace(/\s+/g,",");d=","+d+",";var f;for(var e=0,c=this.selectArray.length;e<c;e++){if(d.indexOf(","+this.settings.selects[e]+",")>-1){f=e}}if(typeof f==="number"){f+=1;this.getOptionData(f)}};b.getOptionData=function(k,e){var r=this;if(typeof k!=="number"||isNaN(k)||k<0||k>=r.selectArray.length){return}var c=k-1;var f=r.selectArray[k];var o;var j;var s;var p={};var n=f.data("url");var q=typeof f.data("jsonSpace")==="undefined"?r.settings.jsonSpace:f.data("jsonSpace");var m;var d;for(var h=0,g=r.selectArray.length;h<g;h++){if(h>=k){r.selectArray[h].empty().prop("disabled",true);if(r.settings.nodata==="none"){r.selectArray[h].css("display","none")}else{if(r.settings.nodata==="hidden"){r.selectArray[h].css("visibility","hidden")}}}}if(typeof n==="string"&&n.length){if(c>=0){if(!r.selectArray[c].val().length){return}m=f.data("queryName");d=r.selectArray[c].attr("name");if(typeof m==="string"&&m.length){p[m]=r.selectArray[c].val()}else{if(typeof d==="string"&&d.length){p[d]=r.selectArray[c].val()}}}a.getJSON(n,p,function(w){j=w;if(typeof q==="string"&&q.length){var u=q.split(".");for(var v=0,t=u.length;v<t;v++){j=j[u[v]]}}r.buildOption(f,j)})}else{if(r.dataJson&&typeof r.dataJson==="object"){j=r.dataJson;for(var h=0,g=r.selectArray.length;h<g;h++){if(h<k){s=r.getIndex(r.selectArray[h][0].selectedIndex);if(typeof j[s]==="object"&&a.isArray(j[s][r.settings.jsonSub])&&j[s][r.settings.jsonSub].length){o=h;j=j[s][r.settings.jsonSub]}}}if(c<0||c===o){r.buildOption(f,j)}}}};b.buildOption=function(m,f){var n=this;var h=typeof m.data("firstTitle")==="undefined"?n.settings.firstTitle:String(m.data("firstTitle"));var j=typeof m.data("firstValue")==="undefined"?n.settings.firstValue:String(m.data("firstValue"));var g=typeof m.data("jsonName")==="undefined"?n.settings.jsonName:String(m.data("jsonName"));var k=typeof m.data("jsonValue")==="undefined"?n.settings.jsonValue:String(m.data("jsonValue"));if(!a.isArray(f)){return}var c=!n.settings.required?'<option value="'+j+'">'+h+"</option>":"";if(g.length){if(!k.length){k=g}for(var e=0,d=f.length;e<d;e++){c+='<option value="'+String(f[e][k])+'">'+String(f[e][g])+"</option>"}}else{for(var e=0,d=f.length;e<d;e++){c+='<option value="'+String(f[e])+'">'+String(f[e])+"</option>"}}m.html(c).css({"display":"","visibility":""});if(!m.attr("data-disable")){m.prop("disabled",false)}if(typeof m.data("value")!=="undefined"){m.val(String(m.data("value"))).removeAttr("data-value")}m.trigger("change")};b.init.apply(b,arguments);return this};a.cxSelect.defaults={selects:[],url:null,nodata:null,required:false,firstTitle:"请选择",firstValue:"",jsonSpace:"",jsonName:"n",jsonValue:"",jsonSub:"s"};a.fn.cxSelect=function(b,c){this.each(function(d){a.cxSelect(this,b,c)});return this}}));